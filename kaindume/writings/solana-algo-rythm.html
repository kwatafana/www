<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="J. G. Kaindume seestem@merely.tech" />
  <title>Solana Algo-rythm</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">html {
line-height: 1.5;
font-family: Georgia, serif;
font-size: 20px;
color: cyan;
background-color: #222D31;
}
.title{
font-size: 1.5em;
font-weight: bolder;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
word-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 1em;
}
}
@media print {
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: cyan;
}
a:visited {
color: cyan;
}
img {
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
font-size: 85%;
margin: 0;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
background-color: cyan;
border: none;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid cyan;
border-bottom: 1px solid cyan;
}
th {
border-top: 1px solid cyan;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}
</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Solana Algo-rythm</h1>
<p class="subtitle">◎</p>
<p class="author">J. G. Kaindume <a href="mailto:seestem@merely.tech" class="email">seestem@merely.tech</a></p>
<p class="date">2022-02-02 (Draft)</p>
</header>
<nav id="TOC" role="doc-toc">
<ul class="incremental">
<li><a href="#section">◎</a>
<ul class="incremental">
<li><a href="#analogy-table">Analogy Table</a></li>
<li><a href="#bands-clusters">Bands (Clusters)</a></li>
<li><a href="#notes-transactions">Notes (Transactions)</a>
<ul class="incremental">
<li><a href="#signatures">Signatures</a></li>
<li><a href="#message">Message</a></li>
<li><a href="#putting-it-together">Putting it together</a></li>
</ul></li>
<li><a href="#accounts-1">Accounts</a>
<ul class="incremental">
<li><a href="#rent">Rent</a></li>
<li><a href="#signing">Signing</a></li>
<li><a href="#account-structure">Account Structure</a></li>
</ul></li>
<li><a href="#conductors-programs">Conductors (Programs)</a>
<ul class="incremental">
<li><a href="#conductors-table-id-program-id">(Conductors Table ID) Program ID</a></li>
<li><a href="#program-logic">Program Logic</a></li>
</ul></li>
<li><a href="#specs">Specs</a></li>
<li><a href="#references">References</a></li>
</ul></li>
</ul>
</nav>
<hr />
<h1 id="section">◎</h1>
<p>One can think of <a href="https://github.com/solana-labs/solana">Solana</a> as an unusually large band that is perpetually performing live music at a concert. Every song the band plays is composed by the band’s lead player from musical notes written on paper tokens. The tokens are given to the lead player by the spectators (users), the other band members have to validate that they can harmoniously play the song and only then is the song played and added to the band’s album (ledger).</p>
<pre class="text"><code>It is the responsibility of the band leader to compose these notes in 
a way that can be harmoniously played by the rest of the band.</code></pre>
<p>The band members practice the same song from the notes they got from the band leader, if they are satisfied with the song (<em>block</em>) produced and it matches up with the song by the band leader (note composition) they cast their vote for the song. These votes are used by the band to decide wheter to play the song or not (add it to the album (ledger)).</p>
<pre class="text"><code>A new leader is elected every 10 seconds.</code></pre>
<hr />
<h3 id="analogy-table">Analogy Table</h3>
<table>
<thead>
<tr class="header">
<th>Solana</th>
<th>Analogy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cluster</td>
<td>Band</td>
</tr>
<tr class="even">
<td>Users</td>
<td>Spectators</td>
</tr>
<tr class="odd">
<td>Node/ Validator</td>
<td>Band member</td>
</tr>
<tr class="even">
<td>Leader</td>
<td>Band Lead Player</td>
</tr>
<tr class="odd">
<td>Ledger (Blockchain)</td>
<td>Album</td>
</tr>
<tr class="even">
<td>Block</td>
<td>Song</td>
</tr>
<tr class="odd">
<td>Blockhash</td>
<td>Song title</td>
</tr>
<tr class="even">
<td>Transaction</td>
<td>Note</td>
</tr>
<tr class="odd">
<td>Program(Smart contract)</td>
<td>Band conductors</td>
</tr>
<tr class="even">
<td>Instruction</td>
<td>Instructions for conductors</td>
</tr>
<tr class="odd">
<td>Accounts</td>
<td>Concert Tables for spectators (Desks)</td>
</tr>
<tr class="even">
<td>SOL/lamports</td>
<td>Paper Tokens for writing the ‘Notes’ (Raffle tickets)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="bands-clusters">Bands (Clusters)</h2>
<pre class="text"><code>A particular band that plays music together. </code></pre>
<p>A cluster is a network of computers working together to validate transactions.</p>
<table>
<colgroup>
<col style="width: 26%"></col>
<col style="width: 24%"></col>
<col style="width: 49%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Cluster</th>
<th>Purpose</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Testnet (Rehersal in your garage)</td>
<td>Solana blockchain new feature tests</td>
<td><a href="https://api.testnet.solana.com">https://api.testnet.solana.com</a></td>
</tr>
<tr class="even">
<td>Devnet (Rehersal before the show)</td>
<td>Developer playground</td>
<td><a href="https://api.devnet.solana.computers">https://api.devnet.solana.computers</a></td>
</tr>
<tr class="odd">
<td>Mainet Beta (Performing a Live concert)</td>
<td>Real deal, real money</td>
<td><a href="https://api.mainnet-beta.solana.com">https://api.mainnet-beta.solana.com</a></td>
</tr>
</tbody>
</table>
<blockquote>
<p>More info <a href="https://docs.solana.com/clusters">here</a>.</p>
</blockquote>
<hr />
<h2 id="notes-transactions">Notes (Transactions)</h2>
<pre class="text"><code>The concert spectators  are the ones who give notes to the band, the 
band leader then composes a song that will be harmoniously 
played by the rest of the band.

The spectators are the users of the cluster, they have 
transactions(notes) that they want to be part of the band&#39;s album
(cluster&#39;s ledger). These transactions can only be included if 
all nodes reach consensus via Proof of Stake and Proof of History.</code></pre>
<p>Technically a <code>Transaction</code> like everything else on a computer is merely a string of bits, the size of a transaction cannot exceed <strong>9856</strong> bits (<strong>1232</strong> bytes). A transaction consists of two parts <code>Signatures</code> and a <code>Message</code>:</p>
<h3 id="signatures">Signatures</h3>
<p>Solana Transactions can include multiple signatures. All the <code>Account</code>s that will be modified by the transaction should sign the transaction before it is sent to the cluster.</p>
<blockquote>
<p>Each digital signature is in the ed25519 binary format and consumes 64 bytes.</p>
<p>~ <a href="https://docs.solana.com/developing/programming-model/transactions#signature-format">Official docs</a></p>
</blockquote>
<p>In the holy language of <a href="https://rust-lang.org/">Rust</a> this would be described as:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co">//...</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="kw">pub</span> signatures<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>Signature<span class="op">&gt;,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="co">//...</span></span></code></pre></div>
<h3 id="message">Message</h3>
<p>The message itself consists of 4 parts the:</p>
<ul class="incremental">
<li><code>Header</code></li>
<li><code>Account addresses</code></li>
<li>a recent <code>Blockhash</code></li>
<li><code>Instructions</code></li>
</ul>
<h4 id="header-metadata">Header (Metadata)</h4>
<pre class="text"><code> # = number of
 
bits 
    +-----------------------------------------------+  \
 8  |            # required signatures              |  |
    +-----------------------------------------------+  |
 8  |          # accounts to be read-only           |  |~Header
    +-----------------------------------------------+  |
 8  | # read-only accounts not requiring signatures |  |
    +-----------------------------------------------+ /</code></pre>
<p>The first 8 bits of the header should correspond to the number of signatures that signed the transactions (owners of accounts to be modified).</p>
<p>The next 8 bits indicates the accounts that are not modified by the transaction but are read only.</p>
<p>The last 8 bits of the header is the number of read-only accounts not requiring signatures.</p>
<p>In Rust the message header is defined as:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> MessageHeader <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    <span class="kw">pub</span> num_required_signatures<span class="op">:</span> <span class="dt">u8</span><span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    <span class="kw">pub</span> num_readonly_signed_accounts<span class="op">:</span> <span class="dt">u8</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span class="kw">pub</span> num_readonly_unsigned_accounts<span class="op">:</span> <span class="dt">u8</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<blockquote>
<p><a href="https://docs.rs/solana-sdk/latest/solana_sdk/message/struct.MessageHeader.html">source</a></p>
</blockquote>
<h4 id="accounts">Accounts</h4>
<p>This is an array, the accounts that have signed the transaction appear first followed by the others:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co">//...</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a> <span class="kw">pub</span> account_keys<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>Pubkey<span class="op">,</span> Global<span class="op">&gt;,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="co">//...</span></span></code></pre></div>
<blockquote>
<p><a href="https://docs.rs/solana-sdk/latest/solana_sdk/message/v0/struct.Message.html">source</a></p>
</blockquote>
<h4 id="blockhash">Blockhash</h4>
<pre class="text"><code>Before the music spectators suggests gives the band a note to play, the
spectator should make sure they have listened to the bands recent 
songs this lets the band know that the spectator is a true fan.

A blockhash is the title of a specific song (block) by the band.</code></pre>
<p>More concretely a blockhash is a 32-byte SHA-256 hash of a recent block.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="co">//...</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="kw">pub</span> recent_blockhash<span class="op">:</span> <span class="bu">Hash</span><span class="op">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="co">//...</span></span></code></pre></div>
<blockquote>
<p><a href="https://docs.rs/solana-sdk/latest/solana_sdk/message/v0/struct.Message.html">source</a></p>
</blockquote>
<h4 id="instructions">Instructions</h4>
<pre class="text"><code>As we said before the band is told what to play by the spectators
based on the notes they give to the band. The band also has somewhat 
dormantconductors. These conductors follow specific set of 
instructions also given by the listeners.

The conductors are the Solana programs (smart contracts), the 
instructions are hardcoded in the programs logic and users can access
these instructions via transactions.</code></pre>
<p>A <code>Instruction</code> consists of a index (pointer) to the one of the accounts In the message’s <code>Account</code> array, account addresses which are multiple indexes to In the message’s <code>Account</code> array and an 8bit array of generic data.</p>
<pre class="text"><code> var = varies
 
bits 
     +--------------------------+  \
 8   |    Program ID (Index)    |  |
     +--------------------------+  |
 var |  Account Address Indexes |  |~Instruction
     +--------------------------+  |
 8   |    Opaque data           |  |
     +--------------------------+ /</code></pre>
<p>In the Rust it looks like this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> CompiledInstruction <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>    <span class="kw">pub</span> program_id_index<span class="op">:</span> <span class="dt">u8</span><span class="op">,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>    <span class="kw">pub</span> accounts<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">,</span> Global<span class="op">&gt;,</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>    <span class="kw">pub</span> data<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">,</span> Global<span class="op">&gt;,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>            </span></code></pre></div>
<blockquote>
<p><a href="https://docs.rs/solana-sdk/latest/solana_sdk/instruction/struct.CompiledInstruction.html">source</a></p>
</blockquote>
<h3 id="putting-it-together">Putting it together</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> Transaction <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>    <span class="kw">pub</span> signatures<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>Signature<span class="op">&gt;,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>    <span class="kw">pub</span> message<span class="op">:</span> Message<span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<blockquote>
<p><a href="https://docs.rs/solana-sdk/latest/solana_sdk/transaction/struct.Transaction.html">source</a></p>
</blockquote>
<hr />
<h2 id="accounts-1">Accounts</h2>
<pre class="text"><code>Every spectator at the concert sits at a specific table, each table 
holds various objects one of them being a busket of paper tokens on 
which the spectator writes down notes they want the band to play, 
which they hand over to the band leader.</code></pre>
<p>Users can have accounts (tables) with a 256-bit public key as the account’s address. These accounts hold state between transactions. Every account has an <strong>owner</strong> (Spectator sitting at the table). Every account also has an amount of <strong>lamports</strong> that they own (paper tokens on which notes are written).</p>
<h3 id="rent">Rent</h3>
<pre class="text"><code>Because this is a very popular band, and there is limited space at the
venue the concert is being held, the band came up with a brilliant 
idea to allow every fan to get a chance to see them live and to 
maximize their profits (:

Once a spectator&#39;s paper tokens finish the spectator is removed from 
the table by the band. The table is cleaned up and room is made for 
someone else waiting outside. To speed up things each band member
periodically collects tokens from the tables, unless it is a VIP 
table (a table that has bought a substantial amount of tokens).</code></pre>
<p>Once an account’s amount of <strong>lamports</strong> is 0 it will be removed from the cluster.</p>
<p>Accounts also pay <strong>rent</strong> for storage to validators, the validators do this by periodically collecting <strong>lamports</strong> from all the accounts in the cluster, except for <strong>accounts that hold at least 2 years worth of rent, those do not pay rent</strong>.</p>
<h3 id="signing">Signing</h3>
<pre class="text"><code>The spectator writes the notes they want to hear on a paper token, but
before they hand it over to the band leader the spectator has to sign
it with their unique signature. The signature allows the band to 
verify that the notes are indeed from a the spectator sitted at the 
specific table.</code></pre>
<p>A transaction should include the account’s digital signature, this indicates that the transaction was sent by the owner of the account (holder of private key that corresponds to the account’s public key).</p>
<h3 id="account-structure">Account Structure</h3>
<p>This is how an account is structured in RUST:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> Account <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>    <span class="co">/// lamports in the account</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>    <span class="kw">pub</span> lamports<span class="op">:</span> <span class="dt">u64</span><span class="op">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>    <span class="co">/// data held in this account</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>    <span class="kw">pub</span> data<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>    <span class="co">/// the program that owns this account. </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>    <span class="co">/// If executable, the program that loads this account.</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>    <span class="kw">pub</span> owner<span class="op">:</span> Pubkey<span class="op">,</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>    <span class="co">/// this account&#39;s data contains a loaded program (and is now read-only)</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>    <span class="kw">pub</span> executable<span class="op">:</span> <span class="dt">bool</span><span class="op">,</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a>    <span class="co">/// the epoch at which this account will next owe rent</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true"></a>    <span class="kw">pub</span> rent_epoch<span class="op">:</span> Epoch<span class="op">,</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true"></a><span class="op">}</span>                                           </span></code></pre></div>
<blockquote>
<p><a href="https://docs.rs/solana-sdk/latest/solana_sdk/account/struct.Account.html">source</a></p>
</blockquote>
<hr />
<h2 id="conductors-programs">Conductors (Programs)</h2>
<pre class="text"><code>Not only does the band get notes to play from the concert spectators
but they can also get special instructions from multiple 
band conductors, these instructions are also based on the notes from
the spectators.</code></pre>
<p>The conductors are Solana programs aka smart contracts (Accounts marked as “executable”), which live on the blockchain, users can use these programs by sending special instructions to the cluster that call specific programs, these instructions are embedded in the transactions from the users.</p>
<p><a href="https://anchor.projectserum.com/">Anchor</a> is a Rust framework for writing Solana programs, we will use it to write Solana programs.</p>
<p>To use Anchor in you Rust project include it in your <code>Cargo.toml</code> file and then import its prelude:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="co">// use this import to gain access to common anchor features</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">anchor_lang::prelude::</span><span class="op">*;</span></span></code></pre></div>
<h3 id="conductors-table-id-program-id">(Conductors Table ID) Program ID</h3>
<pre class="text"><code>Every conductor sits at a table from where it gives out instructions to 
the band. The table has a unique ID.</code></pre>
<p>In Anchor a program’s ID is declared using the <code>declare_id</code> macro:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="co">// declare an id for your program</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="pp">declare_id!</span>(<span class="st">&quot;Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS&quot;</span>)<span class="op">;</span></span></code></pre></div>
<blockquote>
<p><a href="https://docs.rs/anchor-lang/latest/anchor_lang/macro.declare_id.html">source</a></p>
</blockquote>
<h3 id="program-logic">Program Logic</h3>
<pre class="text"><code>Each conductors has its own distinct list of instructions that it can 
give to the band.</code></pre>
<p>Programs can instruct the cluster using instructions.</p>
<p>The <code>#[program]</code> macro is used on a Rust module that holds a list of functions, these functions are the instruction handlers, they can be called by Solana clients (<a href="https://docs.rs/anchor-client/latest/anchor_client/">Anchor Rust Client</a>, <a href="https://project-serum.github.io/anchor/ts/index.html">Anchor Typescript Client</a>):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">anchor_lang::prelude::</span><span class="op">*;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a><span class="pp">declare_id!</span>(<span class="st">&quot;Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS&quot;</span>)<span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a><span class="at">#[</span>program<span class="at">]</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a><span class="kw">mod</span> my_program <span class="op">{</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>    <span class="co">//! This module will contain a list of functions to handle </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h4 id="program-instruction-and-accounts">Program Instruction and Accounts</h4>
<p>The <code>#[account]</code> attribute is used on structs that hold data owned by the program (the program identified with the ID declared with the <code>declareId</code> macro):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="at">#[</span>account<span class="at">]</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Default</span><span class="at">)]</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> MyAccount <span class="op">{</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a>    data<span class="op">:</span> <span class="dt">u64</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>Every call to an instruction should be accompanied by data that is deserialzed from a struct marked with the <code>#[derive(Accounts)]</code> attribute:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span>Accounts<span class="at">)]</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> SetData<span class="op">&lt;</span><span class="ot">&#39;info</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>    <span class="at">#[</span>account<span class="at">(</span><span class="kw">mut</span><span class="at">)]</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>    <span class="kw">pub</span> my_account<span class="op">:</span> Account<span class="op">&lt;</span><span class="ot">&#39;info</span><span class="op">,</span> MyAccount<span class="op">&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>Putting <code>#[account]</code>, <code>#[derive(Accounts)]</code> and <strong>instructions</strong> together:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="co">//...</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a><span class="at">#[</span>program<span class="at">]</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a><span class="kw">mod</span> my_program <span class="op">{</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a>    <span class="kw">use</span> <span class="kw">super</span><span class="pp">::</span><span class="op">*;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_data(ctx<span class="op">:</span> Context<span class="op">&lt;</span>SetData<span class="op">&gt;,</span> data<span class="op">:</span> <span class="dt">u64</span>) <span class="op">-&gt;</span> ProgramResult <span class="op">{</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a>        ctx<span class="op">.</span>accounts<span class="op">.</span>my_account<span class="op">.</span>data <span class="op">=</span> data<span class="op">;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true"></a>        <span class="cn">Ok</span>(())</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true"></a><span class="at">#[</span>account<span class="at">]</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Default</span><span class="at">)]</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> MyAccount <span class="op">{</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true"></a>    data<span class="op">:</span> <span class="dt">u64</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span>Accounts<span class="at">)]</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> SetData<span class="op">&lt;</span><span class="ot">&#39;info</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true"></a>    <span class="at">#[</span>account<span class="at">(</span><span class="kw">mut</span><span class="at">)]</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true"></a>    <span class="kw">pub</span> my_account<span class="op">:</span> Account<span class="op">&lt;</span><span class="ot">&#39;info</span><span class="op">,</span> MyAccount<span class="op">&gt;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h4 id="constraints">Constraints</h4>
<p>We can give various <strong>constraints</strong> to the <code>#[account]</code> attribute, here are a few commonly used constraints:</p>
<table>
<colgroup>
<col style="width: 38%"></col>
<col style="width: 61%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Constraint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>#[account(mut)]</code></td>
<td>The given account should be mutable</td>
</tr>
<tr class="even">
<td><code>#[account(constraint = &lt;expr&gt;)]</code></td>
<td>Checks whether the given expression evaluates to true</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p><a href="https://docs.rs/anchor-lang/latest/anchor_lang/derive.Accounts.html#constraints">More Info</a></p>
</blockquote>
<hr />
<h2 id="specs">Specs</h2>
<table>
<thead>
<tr class="header">
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Network speed</td>
<td>1 gbps network</td>
</tr>
<tr class="even">
<td>Max Throughput</td>
<td>710k Transactions per seconds</td>
</tr>
<tr class="odd">
<td>Native Token</td>
<td>SOL</td>
</tr>
<tr class="even">
<td>Fractional amount</td>
<td>lamports (0.000000001 SOL)</td>
</tr>
<tr class="odd">
<td>Max transaction size</td>
<td>1232 bytes</td>
</tr>
<tr class="even">
<td>Signature Format</td>
<td>ed25519 digital signature (64 bytes)</td>
</tr>
<tr class="odd">
<td>blockhash</td>
<td>SHA-256 (32-byte)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="references">References</h2>
<ul class="incremental">
<li><a href="https://docs.solana.com/">Solana Documentation</a></li>
<li><a href="https://book.anchor-lang.com/chapter_1/introduction.html">Anchor Book</a></li>
<li><a href="https://project-serum.github.io/anchor/getting-started/introduction.html">Anchor Documentation</a></li>
<li><a href="https://docs.rs/anchor-lang/latest/anchor_lang/">Anchor Core API</a></li>
<li><a href="https://docs.rs/anchor-client/latest/anchor_client/">Anchor Rust Client API</a></li>
<li><a href="https://project-serum.github.io/anchor/ts/index.html">Anchor Typescript API</a></li>
</ul>
<hr />
<p><a href="mailto:seestem@merely.tech" class="email">seestem@merely.tech</a> | <a href="https://kwatafana.org">kwatafana ⧉</a></p>
</body>
</html>
